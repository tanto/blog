<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:gml="http://www.opengis.net/gml"

	xmlns:media="http://search.yahoo.com/mrss/"
	>

<channel>
	<title>TANTO &#187; ESRI</title>
	<atom:link href="http://blog.spaziogis.it/tag/esri/feed/" rel="self" type="application/rss+xml" />
	<link>http://blog.spaziogis.it</link>
	<description>le cose che ci piacciono ...</description>
	<lastBuildDate>Mon, 07 Nov 2016 09:59:24 +0000</lastBuildDate>
	<language>it-IT</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<xhtml:meta xmlns:xhtml="http://www.w3.org/1999/xhtml" name="robots" content="noindex" />
		<item>
		<title>Take the best, use the REST</title>
		<link>http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/</link>
		<comments>http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/#comments</comments>
		<pubDate>Mon, 29 Dec 2014 14:00:56 +0000</pubDate>
		<dc:creator>Andrea Borruso</dc:creator>
				<category><![CDATA[Didattica]]></category>
		<category><![CDATA[ArcGIS]]></category>
		<category><![CDATA[dati]]></category>
		<category><![CDATA[ESRI]]></category>
		<category><![CDATA[gdal/ogr]]></category>
		<category><![CDATA[query]]></category>
		<category><![CDATA[rest]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/?p=6507</guid>
		<description><![CDATA[	
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Take+the+best%2C+use+the+REST&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2014-12-29&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/&amp;rft.language=English"></span>
Diversi geoportali, piccoli e grandi, di Pubbliche Amministrazioni da ogni parte del mondo, sono basati su tecnologia ESRI ArcGIS. All&#8217;utente di solito viene esposta un&#8217;interfaccia di consultazione del catalogo dei dataset (come quella del geoportale della Regione Siciliana) e/o l&#8217;accesso diretto ai dati e alla loro rappresentazione tramite servizi OGC standard come WMS, WFS e WCS. Ma ci [...]]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Take+the+best%2C+use+the+REST&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2014-12-29&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p>Diversi geoportali, piccoli e grandi, di Pubbliche Amministrazioni da ogni parte del mondo, sono basati su tecnologia ESRI ArcGIS. All&#8217;utente di solito viene esposta un&#8217;interfaccia di consultazione del <strong>catalogo</strong> dei dataset (come quella del <a href="http://www.google.com/url?q=http%3A%2F%2Fwww.sitr.regione.sicilia.it%2Fgeoportale&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNG7RUw_DCXDDpf6kHOLLKGZrZnT0Q" target="_blank">geoportale</a> della Regione Siciliana) e/o l&#8217;accesso diretto ai dati e alla loro rappresentazione tramite <strong>servizi OGC</strong> standard come WMS, WFS e WCS.</p>
	<p>Ma ci sono diverse altre caratteristiche interessanti rese disponibili da queste tecnologie e che molto spesso ignoriamo, la cui conoscenza ci consente di accedere ad un numero molto più ampio di informazioni e dati. Tutto questo oggi è a maggior forza interessante, grazie alle politiche Open Data realizzate da molte Pubbliche Amministrazioni e anche perché dal <strong>19 marzo 2013</strong>i &#8221;tutti i dati e documenti che le pubbliche amministrazioni pubblicano con qualsiasi modalità, senza l’espressa adozione di una licenza d’uso, si intendono rilasciati come dati aperti (<strong>open data by default</strong>)&#8221; (cit. dati.gov.it, mentre dal punto di vista normativo si tratta dell&#8217;<strong>articolo 52, comma 2</strong> del <strong><a href="http://www.agid.gov.it/cad/accesso-telematico-riutilizzo-dati-pubbliche-amministrazioni" target="_blank">CAD</a></strong>).</p>
	<p>In questo post sottolineerò alcuni elementi relativi all&#8217;accesso ai dati tramite <em>query</em> via interfaccia <strong>REST</strong> (più propriamente tramite API REST).</p>
	<h2 id="introduzione">Introduzione</h2>
	<p>Le API REST di ArcGIS &#8211; REST è l&#8217;acronimo di <em>Representational State Transfer</em> - forniscono una semplice <strong>interfaccia</strong> di <strong>accesso web</strong> ai server cartografici di questa casa software, sia ai dati/servizi che ad alcuni processi. Il tutto è quindi accessibile tramite una serie di URL gerarchici, che identificano ciò a cui si vuole accedere. L&#8217;URL di default di accesso ha di _default _questa struttura:</p>
	<pre>http://&lt;host&gt;:/arcgis/rest/services</pre>
	<p>Ad esempio quello della Regione Siciliana è questo:</p>
	<p><a href="http://map.sitr.regione.sicilia.it/ArcGIS/rest/services" target="_blank">http://map.sitr.regione.sicilia.it/ArcGIS/rest/services</a></p>
	<p>E aprendo l&#8217;indirizzo sono elencati dati e servizi disponibili in questo server.</p>
	<p><img class="alignnone size-full wp-image-6513 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/sicilia_rest.png" alt="sicilia_rest" width="500" height="285" /></p>
	<p>La <strong><a href="http://www.google.com/url?q=http%3A%2F%2Fresources.arcgis.com%2Fen%2Fhelp%2Farcgis-rest-api%2Findex.html%23%2FThe_ArcGIS_REST_API&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHuezGAZ5-mzV-FZry6S5ZmvV-AAA" target="_blank">documentazione</a></strong><a href="http://www.google.com/url?q=http%3A%2F%2Fresources.arcgis.com%2Fen%2Fhelp%2Farcgis-rest-api%2Findex.html%23%2FThe_ArcGIS_REST_API&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHuezGAZ5-mzV-FZry6S5ZmvV-AAA" target="_blank"> ufficiale</a> generale è molto ricca e vasta e non aggiungerò altri dettagli generici.</p>
	<p>A seguire invece alcuni esempi di <strong>query</strong>  via ArcGIS REST API, in modo da apprezzarne la ricchezza e le modalità di accesso.</p>
	<h2 id="interroghiamo-una-risorsa">Interroghiamo una risorsa</h2>
	<p>Per gli esempi di questo articolo farò riferimento alla <strong>Regione Umbria</strong>, che ha aperto <a href="http://www.google.com/url?q=http%3A%2F%2Fagendadigitale.regione.umbria.it%2Fcartografia-umbria%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGh7oXngcnvcK4DvFY_uBWgTYXftw" target="_blank">da poco</a> i suoi dati cartografici. Dal suo portale open data possiamo leggere l&#8217;URL pubblico del server ArcGIS.</p>
	<p><img class="alignnone size-full wp-image-6514 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/url_umbria.png" alt="url_umbria" width="500" height="232" /></p>
	<p>Si legge</p>
	<pre>http://geo.umbriaterritorio.it/arcgis/</pre>
	<p>Bisogna aggiungere (vedi sopra) &#8220;rest/services/&#8221; e abbiamo</p>
	<p><a href="http://geo.umbriaterritorio.it/arcgis/rest/services/" target="_blank">http://geo.umbriaterritorio.it/arcgis/rest/services/</a></p>
	<p>A questo punto non resta che sfogliare un po&#8217; la <em>directory</em> pubblica e scegliere un <em>layer</em> su cui eseguire una <em>query</em>. Userò il dataset dei &#8220;NUMERI CIVICI&#8221;, che si raggiunge facendo click su <a href="http://www.google.com/url?q=http%3A%2F%2Fgeo.umbriaterritorio.it%2FArcGIS%2Frest%2Fservices%2FPublic%2FECOGRAFICO_CATASTALE1_WGS84%2FMapServer%2F0&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGsOAQrrPu5ImWNlAL_d8H3zDdhtQ" target="_blank">Public &gt; ECOGRAFICO_CATASTALE_WGS84 (MapServer) &gt; NUMERI CIVICI</a>.</p>
	<p>Scorrendo la pagina verso il basso è visibile il tasto &#8220;<em>Query</em>&#8220;, tramite il quale è possibile interrogare il dataset.</p>
	<p><img class="alignnone size-full wp-image-6512 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/query.png" alt="query" width="500" height="370" /></p>
	<p>Per lanciare la prima interrogazione devo inserire almeno un criterio di ricerca. Ad esempio <a href="http://www.google.com/url?q=http%3A%2F%2Fgeo.umbriaterritorio.it%2FArcGIS%2Frest%2Fservices%2FPublic%2FECOGRAFICO_CATASTALE1_WGS84%2FMapServer%2F0%2Fquery%3Fgeometry%26geometryType%3DesriGeometryPoint%26inSR%26spatialRel%3DesriSpatialRelIntersects%26relationParam%26objectIds%3D1%26where%26time%26returnCountOnly%3Dfalse%26returnIdsOnly%3Dfalse%26returnGeometry%3Dtrue%26maxAllowableOffset%26outSR%26outFields%3D*%26f%3Dhtml&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH6iLFbjBb4YxEY1dKVGuFrZBhiMQ" target="_blank">il numero civico con &#8220;ID=1&#8243;</a> (ogni elemento ha sempre un identificativo numerico associato). La pagina html con il risultato dell&#8217;interrogazione mi fornisce informazioni sia sugli attributi che sulla geometria dell&#8217;elemento.</p>
	<p><img class="alignnone size-full wp-image-6509 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/attributi.png" alt="attributi" width="382" height="212" /></p>
	<p>Posso fare allora una query per <strong>attributo</strong>: <a href="http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=&#038;geometryType=esriGeometryPoint&#038;inSR=&#038;spatialRel=esriSpatialRelIntersects&#038;relationParam=&#038;objectIds=&#038;where=DESCR_S49+LIKE+%27%25CORPOSANO%25%27&#038;time=&#038;returnCountOnly=false&#038;returnIdsOnly=false&#038;returnGeometry=true&#038;maxAllowableOffset=&#038;outSR=&#038;outFields=*&#038;f=html" target="_blank">tutti gli elementi</a> che contengono nel campo &#8220;DESCR_S49&#8243; la stringa &#8220;CORPOSANO&#8221;. Nell&#8217;interfaccia leggiamo che ci sono 47 record che soddisfano questa condizione e l&#8217;output è in HTML. Ci sono però altri formati di output tra cui <strong>KML</strong> e <strong>JSON</strong>; <a href="http://www.google.com/url?q=http%3A%2F%2Fgeo.umbriaterritorio.it%2FArcGIS%2Frest%2Fservices%2FPublic%2FECOGRAFICO_CATASTALE1_WGS84%2FMapServer%2F0%2Fquery%3Fgeometry%26geometryType%3DesriGeometryPoint%26inSR%26spatialRel%3DesriSpatialRelIntersects%26relationParam%26objectIds%26where%3DDESCR_S49%2BLIKE%2B'%2525CORPOSANO%2525'%26time%26returnCountOnly%3Dfalse%26returnIdsOnly%3Dfalse%26returnGeometry%3Dtrue%26maxAllowableOffset%26outSR%26outFields%3D*%26f%3Dpjson&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHS-5eXTUQRW6lngrc9W3yzjDYWZg" target="_blank">questo</a> l&#8217;output in JSON della stessa query.</p>
	<p><img class="alignnone size-full wp-image-6511 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/output.png" alt="output" width="500" height="116" /></p>
	<p>Questi due formati quindi mostrano nei fatti, come una query REST su server ArcGIS sia un&#8217;ulteriore modalità di accesso al dato grezzo.</p>
	<h2>Query spaziale</h2>
	<p>E&#8217; possibile eseguire anche delle interrogazioni spaziali di complessità variabile. Ad esempio posso estrarre tutti i civici che ricadono tra queste coordinate <a href="http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=12.384356%2C+43.108511%2C12.388869%2C43.110765&amp;geometryType=esriGeometryEnvelope&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;relationParam=&amp;objectIds=&amp;where=&amp;time=&amp;returnCountOnly=false&amp;returnIdsOnly=false&amp;returnGeometry=true&amp;maxAllowableOffset=&amp;outSR=&amp;outFields=*&amp;f=html" target="_blank">12.384356,43.108511,12.388869,43.110765</a> (&lt;xmin&gt;,&lt;ymin&gt;,&lt;xmax&gt;,&lt;ymax&gt;).</p>
	<p><img class="alignnone size-full wp-image-6542 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query.png" alt="spatial_query" width="496" height="118" /></p>
	<p>Posso farne il download con GDAL/OGR (vedi sotto) e ottenere rapidamente i dati in formato spaziale e al contempo visualizzarne rapidamente una loro rappresentazione.</p>
	<p><img class="alignnone size-full wp-image-6543 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query_map.jpg" alt="spatial_query_map" width="500" height="394" /></p>
	<h2 id="accesso-tramite-gdal/ogr-a-una-query">Accesso tramite GDAL/OGR a una query</h2>
	<p>La libreria <strong>GDAL/OGR</strong> ha i driver di accesso in lettura e scrittura al <a href="http://www.google.com/url?q=http%3A%2F%2Fwww.gdal.org%2Fdrv_geojson.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEYFJK4I_iIh-CbRFHchaL-132kJg" target="_blank">formato GeoJSON</a>. Uno degli output delle query di sopra è proprio JSON e questa libreria lo riesce a leggere nativamente proprio come GeoJSON.</p>
	<p>L&#8217;ultima query si effettua chiamando <a href="http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=&amp;geometryType=esriGeometryPoint&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;relationParam=&amp;objectIds=&amp;where=DESCR_S49+LIKE+%27%25CORPOSANO%25%27&amp;time=&amp;returnCountOnly=false&amp;returnIdsOnly=false&amp;returnGeometry=true&amp;maxAllowableOffset=&amp;outSR=&amp;outFields=*&amp;f=pjson" target="_blank">questo lungo URL</a>:</p>
	<pre>http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=&amp;geometryType=esriGeometryPoint&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;relationParam=&amp;objectIds=&amp;<strong>where</strong>=DESCR_S49+LIKE+%27%25CORPOSANO%25%27&amp;time=&amp;returnCountOnly=false&amp;returnIdsOnly=false&amp;returnGeometry=true&amp;maxAllowableOffset=&amp;outSR=&amp;outFields=*&amp;<strong>f</strong>=pjson</pre>
	<p>Nell&#8217;indirizzo di sopra sono visibili tutti i parametri disponibili per effettuare un’interrogazione, ma sopra abbiamo valorizzato soltanto la stringa di testo da ricercare in un determinato campo (parametro &#8220;where&#8221;) e il formato di output (parametro &#8220;f&#8221;). Questo URL fa da <em>source</em> per GDAL/OGR. Se voglio avere tutte le <strong>informazioni</strong> su questa sorgente di dati vettoriali userò il classico ogrinfo:</p>
	<pre>ogrinfo -ro &quot;http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=&amp;geometryType=esriGeometryPoint&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;relationParam=&amp;objectIds=&amp;where=DESCR_S49+LIKE+%27%25CORPOSANO%25%27&amp;time=&amp;returnCountOnly=false&amp;returnIdsOnly=false&amp;returnGeometry=true&amp;maxAllowableOffset=&amp;outSR=&amp;outFields=*&amp;f=pjson&quot; OGRGeoJSON</pre>
	<p>&#8220;OGRGeoJSON&#8221; è per GDAL/OGR il nome predefinito del layer di una sorgente GeoJSON. &#8220;-ro&#8221; perché imposto l’accesso in sola lettura.</p>
	<p>Se voglio <strong>convertire</strong> in ArcView Shapefile l&#8217;output di questa query userò ogr2ogr:</p>
	<pre>ogr2ogr CORPOSANO.shp &quot;http://geo.umbriaterritorio.it/ArcGIS/rest/services/Public/ECOGRAFICO_CATASTALE1_WGS84/MapServer/0/query?geometry=&amp;geometryType=esriGeometryPoint&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;relationParam=&amp;objectIds=&amp;where=DESCR_S49+LIKE+%27%25CORPOSANO%25%27&amp;time=&amp;returnCountOnly=false&amp;returnIdsOnly=false&amp;returnGeometry=true&amp;maxAllowableOffset=&amp;outSR=&amp;outFields=*&amp;f=pjson&quot; OGRGeoJSON</pre>
	<p>Come esempio, riporto qui il <a href="http://blog.spaziogis.it/wp-content/uploads//2014/12/CORPOSANO.zip" target="_blank"><strong>download</strong></a> fatto con GDAL/OGR nei formati ArcView Shapefile, GeoJSON e KML.</p>
	<h2 id="web-mapping-a-partire-da-query">Web mapping a partire da query</h2>
	<p>Queste query possono essere visualizzate in maniera molto efficace anche in un&#8217;interfaccia di <em>web mapping</em>. Sia a partire dal salvataggio dell&#8217;output, che tramite chiamata diretta in <em>realtime</em>. La cosa è inoltre resa semplice da una bella libreria rilasciata in <em>open source</em> da ESRI e basata su <strong>Leaflet</strong>: <a href="http://www.google.com/url?q=http%3A%2F%2Fesri.github.io%2Fesri-leaflet&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFHs50dsXaxLd9Jq6RYR_VlXnnM2A" target="_blank">http://esri.github.io/esri-leaflet</a>.</p>
	<p>La query di sopra (quella sulla stringa &#8220;CORPOSANO&#8221;) ad esempio si può rappresentare rapidamente come sotto (click <strong><a href="http://www.google.com/url?q=http%3A%2F%2Ftanto.github.io%2Farcgisqueryrest%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGBS69DEWt-ac8Wj8EnLjQfdhWKfQ" target="_blank">qui</a></strong> per aprire a <strong>schermo intero</strong>).</p>
	<p><a href="http://www.google.com/url?q=http%3A%2F%2Ftanto.github.io%2Farcgisqueryrest%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGBS69DEWt-ac8Wj8EnLjQfdhWKfQ" target="_blank"><img class="alignnone size-full wp-image-6510 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2014/12/leaflet.jpg" alt="leaflet" width="500" height="378" border="0" /></a></p>
	<p>Il codice lo trovate qui: <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Ftanto%2Farcgisqueryrest%2Fblob%2Fgh-pages%2Findex.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNG4onJJ1-fhQ16rPu3V_R3aFE0ofw" target="_blank">https://github.com/tanto/arcgisqueryrest/blob/gh-pages/index.html</a></p>
	<h2 id="alcune-note-in-conclusione">Alcune note in conclusione</h2>
	<p>Sono rimasto molto in superficie, ma l&#8217;intento è quello di mostrare un punto di ingresso poco noto e utile, visto il sempre maggior numero di dati spaziali oggi disponibili e aperti. Di default l&#8217;<em>output</em> di queste _query _è limitato a 1000 risultati, quindi è necessario &#8220;ciclare&#8221; le chiamate. Ad esempio per ID a gruppi di 1000 record:</p>
	<ul id="draft_check_box_list_0">
	<li>inizio con la condizione <a href="http://www.google.com/url?q=http%3A%2F%2Fgeo.umbriaterritorio.it%2FArcGIS%2Frest%2Fservices%2FPublic%2FECOGRAFICO_CATASTALE1_WGS84%2FMapServer%2F0%2Fquery%3Fgeometry%26geometryType%3DesriGeometryPoint%26inSR%26spatialRel%3DesriSpatialRelIntersects%26relationParam%26objectIds%26where%3DOBJECTID%253E%253D1%2Band%2B%2BOBJECTID%253C%253D1000%26time%26returnCountOnly%3Dfalse%26returnIdsOnly%3Dfalse%26returnGeometry%3Dtrue%26maxAllowableOffset%26outSR%26outFields%3D*%26f%3Dhtml&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNESchVZwiY-eDtZyqQ-tWo3yZyDuw" target="_blank">OBJECTID&gt;=1 and OBJECTID&lt;=1000</a>;</li>
	<li>poi OBJECTID&gt;=1001 and OBJECTID&lt;=2000;</li>
	<li>e così via &#8230;</li>
	</ul>
	<p>Il totale (190140 record), da conoscere prima di fare partire il ciclo, si ricava ad esempio con <a href="http://www.google.com/url?q=http%3A%2F%2Fgeo.umbriaterritorio.it%2FArcGIS%2Frest%2Fservices%2FPublic%2FECOGRAFICO_CATASTALE1_WGS84%2FMapServer%2F0%2Fquery%3Fgeometry%26geometryType%3DesriGeometryPoint%26inSR%26spatialRel%3DesriSpatialRelIntersects%26relationParam%26objectIds%26where%3D1%253D1%26time%26returnCountOnly%3Dtrue%26returnIdsOnly%3Dfalse%26returnGeometry%3Dtrue%26maxAllowableOffset%26outSR%26outFields%3D*%26f%3Dhtml&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGXetugfKd8MZId4F4iV-3NJOsWhg" target="_blank">questa query</a>. Ci sono altri modi per ciclare tra i record, questo è solo un esempio.</p>
	<p>L&#8217;accesso REST è molto utile anche con sorgenti di tipo <em>raster</em>, ma magari lo scrive qualcun altro, in un altro post <img src='http://blog.spaziogis.it/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  .</p>
	<p>L&#8217;URL con struttura &#8220;http://&lt;host&gt;:/arcgis/rest/services&#8221; è quello di <em>default</em>. Chi gestisce il server potrebbe usare uno schema diverso.</p>
	<p>Questo post è dedicato al giovane Padawan &#8220;<strong><a href="https://plus.google.com/u/0/114313445728286224740/posts" target="_blank">Flavio</a></strong>&#8220;, che mi ha fatto scoprire <a href="https://www.google.com/url?q=https%3A%2F%2Fhub.qgis.org%2Fwiki%2F17%2FArcgis_rest&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEmBzX8cx7Y0rkxiZXreebrdHQWVw" target="_blank">questa pagina</a> e ha dato la stura alla stesura di questo testo.</p>
	<p>Non mi <strong>REST</strong>a che augurarvi un <strong>buon 2015</strong>!
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/">Take the best, use the REST</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Take+the+best%2C+use+the+REST&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2014-12-29&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2014/12/29/take-the-best-use-the-rest/&amp;rft.language=English"></span>

		<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/sicilia_rest-150x150.png" />
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/sicilia_rest.png" medium="image">
			<media:title type="html">sicilia_rest</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/sicilia_rest-150x150.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/url_umbria.png" medium="image">
			<media:title type="html">url_umbria</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/url_umbria-150x150.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/query.png" medium="image">
			<media:title type="html">query</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/query-150x150.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/attributi.png" medium="image">
			<media:title type="html">attributi</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/attributi-150x150.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/output.png" medium="image">
			<media:title type="html">output</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/output-150x116.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query.png" medium="image">
			<media:title type="html">spatial_query</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query-150x118.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query_map.jpg" medium="image">
			<media:title type="html">spatial_query_map</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/spatial_query_map-150x150.jpg" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2014/12/leaflet.jpg" medium="image">
			<media:title type="html">leaflet</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2014/12/leaflet-150x150.jpg" />
		</media:content>
	</item>
		<item>
		<title>ArcGIS.com il cloud GIS secondo ESRI</title>
		<link>http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/</link>
		<comments>http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/#comments</comments>
		<pubDate>Thu, 22 Jul 2010 08:00:23 +0000</pubDate>
		<dc:creator>Pietro Blu Giandonato</dc:creator>
				<category><![CDATA[Recensioni]]></category>
		<category><![CDATA[ArcGIS]]></category>
		<category><![CDATA[cloud computing]]></category>
		<category><![CDATA[cloud gis]]></category>
		<category><![CDATA[ESRI]]></category>
		<category><![CDATA[webgis]]></category>
		<category><![CDATA[webmapping]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/?p=2328</guid>
		<description><![CDATA[ESRI entra nel mondo dei "GIS in the cloud", ma la sua scelta di "blindare" ArcGIS.com dal punto di vista dell'interoperabilità dei dati e servizi di mappa via web è quanto meno discutibile.]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS.com+il+cloud+GIS+secondo+ESRI&amp;rft.aulast=Giandonato&amp;rft.aufirst=Pietro+Blu&amp;rft.subject=Recensioni&amp;rft.source=TANTO&amp;rft.date=2010-07-22&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p><span id="internal-source-marker_0.40328169893473387" style="background-color: transparent; vertical-align: baseline;">E’ ormai da qualche mese che ESRI, con <a href="http://arcgis.com" target="_blank">ArcGIS.com</a> è ufficialmente con la testa tra le nuvole. Giovanni Allegri ha già dato notizia di </span><a href="http://www.giscloud.com/"><span style="color: #000000;">GISCloud</span></a><span style="background-color: transparent; vertical-align: baseline;"> in un </span><a href="http://blog.spaziogis.it/2010/05/26/gis-cloud-il-cloud-computing-per-il-webgis/"><span style="color: #000000;">precedente articolo</span></a><span style="background-color: transparent; vertical-align: baseline;">, in effetti il primo servizio applicativo di GIS “evoluto” e abbastanza maturo totalmente utilizzabile via web.</span></p>
	<p><span style="background-color: transparent; vertical-align: baseline;">I tempi, la tecnologia e il mercato per parlare di GIS in the cloud &#8211; </span><a href="http://www.vector1media.com/vectorone/?p=624"><span style="color: #000000;">come aveva teorizzato Vector One</span></a><span style="background-color: transparent; vertical-align: baseline;"> due anni fa &#8211; sono dunque ormai maturi, e la scelta di ESRI di lanciare la sua applicazione webGIS quasi assieme alla prossima release di ArcGIS 10 è quindi “dovuta”. Tanto più che la stessa ESRI ha stretto una </span><a href="http://www.esri.com/partners/alliances/amazon/index.html"><span style="color: #000000;">partnership con Amazon Web Services</span></a><span style="background-color: transparent; vertical-align: baseline;">grazie alla quale è possibile “affittare” ArcGIS Server sulla piattaforma di cloud computing di Amazon.</span></p>
	<p><span style="background-color: transparent; vertical-align: baseline;">A mio avviso però, <strong>ArcGIS.com va in totale controtendenza</strong> con le strategie alla base di progetti come appunto </span><a href="http://www.giscloud.com/"><span style="color: #000000;">GISCloud</span></a><span style="background-color: transparent; vertical-align: baseline;"> o anche </span><a href="http://cloudmade.com/"><span style="color: #000000;">CloudMade</span></a><span style="background-color: transparent; vertical-align: baseline;"> e </span><a href="http://geocommons.com/"><span style="color: #000000;">GeoCommons</span></a><span style="background-color: transparent; vertical-align: baseline;"> e in genere quelli basati su svariate soluzioni tecnologiche, volte a garantire l’interoperabilità tra i dati seguendo le specifiche dell’</span><a href="http://www.opengeospatial.org/"><span style="color: #000000;">Open Geospatial Consortium</span></a><span style="background-color: transparent; vertical-align: baseline;">.</span></p>
	<p><span style="background-color: transparent; vertical-align: baseline;"><strong>Un GIS “in the cloud” dovrebbe essere “aperto” per definizione</strong>, almeno per quanto riguarda la possibilità per l’utente di utilizzare dati e servizi di mappa via web provenienti da svariate fonti. Certo, può non esserlo per la parte applicativa, come proprio GISCloud, mentre invece <a href="http://developers.cloudmade.com/projects">CloudMade offre risorse di sviluppo</a>, e ancora GeoCommons offre servizi business <em>ad-hoc</em>. Bene, <strong>ArcGIS.com non lo è</strong> nè dal punto di vista dei dati utilizzabili, nè tanto meno applicativo (avevamo dubbi?), anzi è “ESRIcentrico” in una maniera oserei dire “ottusa”. Gli unici </span><a>contenuti che è possibile caricare</a><span style="background-color: transparent; vertical-align: baseline;"> nel proprio account non sono, tanto per dire, nemmeno shapefile (sic!) ma formati proprietari ESRI come ad esempio Map Package e Layer Package, mentre tra i servizi di mappa via web si possono importare solo quelli erogati mediante ArcGIS Server&#8230; e non certo con formati OGC (WMS, WFS, ecc)!</span></p>
	<p><span style="background-color: transparent; vertical-align: baseline;">Qui sotto potete “ammirare” una mappa che ho realizzato utilizzando esclusivamente </span><a href="http://www.provincia.trapani.sitr.it:8080/joomla/index.php?option=com_content&amp;view=article&amp;id=40&amp;Itemid=40"><span style="color: #000000;">dati erogati dalla Provincia di Trapani</span></a><span style="background-color: transparent; vertical-align: baseline;"> e dalla </span><a href="http://www.sitr.regione.sicilia.it/content/view/101/121/"><span style="color: #000000;">Regione Siciliana</span></a><span style="background-color: transparent; vertical-align: baseline;">, ovviamente mediante ArcGIS Server. In realtà i dati della Provincia sono esposti in maniera un pò confusa, e lo si può notare consultando i singoli servizi nella </span><a href="http://www.provincia.trapani.sitr.it/ArcGIS/rest/services"><span style="color: #000000;">relativa pagina di ArcGIS Server</span></a><span style="background-color: transparent; vertical-align: baseline;">. In sostanza sono stati messi troppi layer assieme, spesso ripetendoli da servizio a servizio. </span><a href="http://88.53.214.52/sitr/rest/services"><span style="color: #000000;">Quelli della Regione</span></a><span style="background-color: transparent; vertical-align: baseline;"> invece sono organizzati con un singolo layer per ogni singolo servizio, e dunque meglio utilizzabili in ArcGIS.com. In realtà mettere più layer insieme in un solo servizio non è affatto sbagliato, anzi, a patto che lo si faccia seguendo il criterio di realizzare una “vista” o mappa, ovvero rendendo gli strati visivamente compatibili (trasparenze, ordine di sovrapposizione, ecc).</span></p>
	<p><iframe width="500" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.arcgis.com/home/webmap/embedViewer.html?webmap=399a583dc48e44d69cc053525eb0952d&amp;zoom=true&amp;scale=true"></iframe><br /><small><a href="http://www.arcgis.com/home/webmap/viewer.html?webmap=399a583dc48e44d69cc053525eb0952d" style="color:#0000FF;text-align:left" target="_blank">Visualizza mappa più grande</a></small></p>
	<p>La mappa, incorporabile in pagine web mediante &lt;iframe&gt;, risulta estremamente scarna, con la possibilità di impostare solo la dimensione e metterci o meno un tool di zoom. L’obiettivo è quello di indurre l’utente a visualizzarla direttamente su ArcGIS.com cliccando sul link “Visualizza una mappa più grande”. E magari fargli aprire un account&#8230;</p>
	<p>Insomma, <strong>il cloud GIS secondo ESRI è chiuso</strong>, sia dal punto di vista applicativo (e questo ci può pure stare) sia dell’interoperabilità con i dati. E di questo francamente non ne vedo proprio la necessità, visto che la sua posizione dominante &#8211; almeno nei segmenti business e pubblico &#8211; è sempre molto salda, e non sarebbe di certo stata intaccata dando la possibilità di utilizzare dati vettoriali come shapefile (non dico PostGIS) e importare servizi di mappa via web con standard OGC.
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/">ArcGIS.com il cloud GIS secondo ESRI</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS.com+il+cloud+GIS+secondo+ESRI&amp;rft.aulast=Giandonato&amp;rft.aufirst=Pietro+Blu&amp;rft.subject=Recensioni&amp;rft.source=TANTO&amp;rft.date=2010-07-22&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2010/07/22/arcgis-com-il-cloud-gis-secondo-esri/&amp;rft.language=English"></span>

	</item>
		<item>
		<title>ArcGIS Server e Google Maps: come misurare correttamente le distanze</title>
		<link>http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/</link>
		<comments>http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/#comments</comments>
		<pubDate>Sun, 25 Apr 2010 22:29:46 +0000</pubDate>
		<dc:creator>Alessio Di Lorenzo</dc:creator>
				<category><![CDATA[Didattica]]></category>
		<category><![CDATA[ESRI]]></category>
		<category><![CDATA[Javascript]]></category>
		<category><![CDATA[projection]]></category>
		<category><![CDATA[Sviluppo]]></category>
		<category><![CDATA[Web 2.0]]></category>
		<category><![CDATA[webmapping]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/?p=1997</guid>
		<description><![CDATA[	
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+e+Google+Maps%3A+come+misurare+correttamente+le+distanze&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2010-04-25&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/&amp;rft.language=English"></span>
Tempo fa scrissi un articolo su ArcGIS Server 9.3 soffermandomi sui servizi REST e le API Javascript ed accennando al fatto che ESRI mette a disposizione delle estensioni per le API di Google Maps e per quelle di Bing Maps. Ultimamente ho lavorato un po&#8217; con le prime e ne ho avuto complessivamente una buona [...]]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+e+Google+Maps%3A+come+misurare+correttamente+le+distanze&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2010-04-25&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p>Tempo fa scrissi <a href="http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/">un articolo</a> su ArcGIS Server 9.3 soffermandomi sui servizi REST e le API Javascript ed accennando al fatto che ESRI mette a disposizione delle estensioni per le API di Google Maps e per quelle di Bing Maps.<br />
Ultimamente ho lavorato un po&#8217; con <a href="http://resources.esri.com/arcgisserver/apis/javascript/gmaps/index.cfm?fa=home" target="_blank">le prime</a> e ne ho avuto complessivamente una buona impressione. Tuttavia, durante lo sviluppo, ho riscontrato un problema nella misurazione delle distanze e delle aree che merita di essere messo in evidenza, soprattutto perché gli esempi della documentazione ESRI non lo fanno a dovere ed anzi, secondo me, risultano leggermente fuorvianti.<br />
Terminata la premessa, prima di andare avanti con l&#8217;articolo, voglio ringraziare <a href="http://www.nicogis.blogspot.com/" target="_blank">Domenico Ciavarella</a>, che mi ha dato un supporto fondamentale per arrivare ad una soluzione che altrimenti starei ancora cercando.</p>
	<h2>La proiezione di Google Maps</h2>
	<p><div id="attachment_2018" class="wp-caption alignright" style="width: 273px"><br />
<img class="size-full wp-image-2018" style="border: 0pt none;" title="mercator" src="http://blog.spaziogis.it/wp-content/uploads//2010/04/mercator1.png" alt="mercator" width="263" height="244" /><p class="wp-caption-text">Effetto di distorsione delle aree</p></div></p>
	<p>Google Maps, Bing Maps ed altri provider (come OpenStreetMap, Yahoo e, di recente, <a href="http://blogs.esri.com/Dev/blogs/arcgisserver/archive/2009/11/20/ArcGIS-Online-moving-to-Google-_2F00_-Bing-tiling-scheme_3A00_-What-does-this-mean-for-you_3F00_.aspx" target="_blank">la stessa ESRI</a>) utilizzano una proiezione nota come <strong>Spherical Mercator</strong>, derivata dalla proiezione di <a href="http://it.wikipedia.org/wiki/Proiezione_cilindrica_centrografica_modificata_di_Mercatore" target="_blank">Mercatore</a>. Il codice <a href="http://www.epsg.org/" target="_blank">EPSG</a> ufficiale è 3785, anche se prima della sua definizione molti software hanno utilizzato l&#8217;ufficioso 900913. L&#8217;identificativo per i software ESRI, tra cui ovviamente ArcGIS Server, è invece 102113.<br />
Questa proiezione considera la Terra come una sfera e consente di includerne completamente la superficie all&#8217;interno di un quadrato.<br />
Quando però si rappresenta una superficie curva su di un piano, come un foglio di carta o il monitor di un computer, si introducono delle deformazioni. In questo caso, man mano che ci si allontana dall&#8217;equatore le aree cartografate subiscono un pesante stiramento sia in senso verticale che orizzontale e diventano, quindi, via via più esagerate verso i poli (la Groenlandia, per esempio, sembra più grande dell&#8217;Africa). Questa proiezione evidentemente non è fatta per minimizzare la deformazione delle aree (la proiezione di Mercatore è <a href="http://it.wikipedia.org/wiki/Proiezione_conforme" target="_blank">conforme</a> infatti), ma risulta vantaggiosa per l&#8217;uso attraverso il web perché consente di applicare un modello efficiente di tassellamento e caching.</p>
	<h2>Il problema&#8230;</h2>
	<p>Ammettiamo di voler creare un&#8217;applicazione di webmapping con le sopracitate estensioni delle API Javascript di ArcGIS Server per Google Maps.<br />
La prima cosa da fare è creare un mapservice in grado di esporre i nostri dati spaziali con la medesima proiezione delle basi cartografiche di Google. Come spiegato nel post dedicato ad ArcGIS Server (linkato all&#8217;inizio di questo articolo) un mapservice &#8220;aggancia&#8221; e pubblica un progetto redatto in ArcMap (il classico .mxd), quindi basta assegnare al dataframe del progetto il sistema di riferimento appropriato (che si trova nella lista dei sistemi proiettati, alla voce WGS 84 Web Mercator, con identificativo 102113), salvare il tutto e pubblicarlo con ArcGIS Server. Niente di difficile insomma.<br />
Focalizziamoci ora sullo sviluppo del client: tra i tanti strumenti che oggi ci si aspetta di trovare in una applicazione WebGIS ci sono i &#8220;righelli&#8221; che consentono di disegnare spezzate e poligoni e di misurarne poi lunghezza ed area. ESRI lo sa, ed ha giustamente incluso un <a href="http://resources.esri.com/help/9.3/arcgisserver/apis/javascript/gmaps/samples/utilities/util_measureline.html" target="_blank">esempio</a> per mostrare come creare questi tool nella documentazione delle sue API.<br />
Abbiamo detto però che l&#8217;uso della proiezione Spherical Mercator provoca una deformazione crescente man mano che ci si spinge verso i poli e, tracciando una spezzata per misurare un oggetto al suolo di dimensioni note, come uno stadio di calcio, ci si accorge dell&#8217;inghippo: è più lungo di quanto dovrebbe essere (circa 146 metri invece di 105-110).<br />
L&#8217;esempio fornito da ESRI non considera la deformazione e può indurre gli sviluppatori all&#8217;errore. E&#8217; vero che una persona con le adeguate conoscenze di geomatica può arrivare ad intuire il rischio insito nell&#8217;uso della proiezione di Google, ma è anche vero che il webmapping è terra di confine tra &#8220;gissologi&#8221; e sviluppatori informatici &#8220;puri&#8221;, senza particolari cognizioni tipiche del mondo gis. Non è per nulla detto, quindi, che chi sviluppa abbia i mezzi per immaginare il problema prima di averci sbattuto il muso e personalmente credo che aver pubblicato un esempio del genere nella documentazione ufficiale, senza neanche accennare alla questione della deformazione, sia stata una leggerezza.</p>
	<h2>&#8230;e la soluzione</h2>
	<p>Non molto tempo fa sul blog di ArcGIS Server è comparso un interessante <a href="http://blogs.esri.com/Dev/blogs/arcgisserver/archive/2010/03/05/Measuring-distances-and-areas-when-your-map-uses-the-Mercator-projection.aspx">post</a> che mette in evidenza il problema della misurazione delle distanze e spiega come comportarsi per risolverlo.<br />
Il servizio che in ArcGIS Server è incaricato di calcolare lunghezze ed aree, il <a href="http://webhelp.esri.com/arcgisserver/9.3/Java/index.htm#geometry_service.htm">Geometry Service</a>, è in grado di svolgere diverse altre operazioni, tra cui la <strong>proiezione al volo</strong> delle geometrie.<br />
Il &#8220;trucco&#8221; consiste nel riproiettare la geometria tracciata dall&#8217;utente nel sistema di riferimento più adatto alla zona mappata prima di effettuarne la misurazione e stampare a schermo il risultato.<br />
Purtroppo lo snippet di codice fornito da ESRI è pronto all&#8217;uso solo per le API Javascript, mentre per le estensioni di Google Maps bisogna fare da soli e il discorso è un po&#8217; meno semplice.<br />
Al posto di questa funzione:</p>
	<pre class="brush: javascript; ">
var sr = new esri.SpatialReference({wkid:32610});
geometryService.project([graphic], sr, function(projectedGraphic) {
geometryService.areasAndLengths(projectedGraphic, function(result) {
var perimeter = result.lengths[0];
var area = result.areas[0];
});
});
</pre>
	<p>abbiamo bisogno di questa:</p>
	<pre class="brush: javascript; ">
var geometryService = new esri.arcgis.gmaps.Geometry(&quot;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer&quot;);
function calculateLengths() {
//Parametri per la riproiezione
var params = new esri.arcgis.gmaps.ProjectParameters();
params.geometries = [polyline];
params.inSpatialReference  = 4326;
params.outSpatialReference = 3004; //Gauss-Boaga fuso Est
//Riproiezione e funzione di callback
geometryService.project(params, getLengths);
}
function getLengths(projectResults){
var url = &quot;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer/lengths&quot;;
var parameters = {
polylines: projectResults.geometries,
sr: 3004
};
esri.arcgis.gmaps.JSONRequest(url, test, parameters);
}
function test(result) {
alert(result.lengths[0]+&quot; m&quot;);
}
</pre>
	<p>Ho realizzato un veloce <a href="http://dl.dropbox.com/u/1070973/Riproiezione_e_misura/index.html" target="blank">esempio</a> che mostra i risultati ottenuti dal codice proposto da ESRI nella propria documentazione a confronto con quelli ottenuti dalla riproiezione con il Geometry Service e dalle semplici API di Google Maps, che hanno dei metodi propri per la misura di linee e poligoni.
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/">ArcGIS Server e Google Maps: come misurare correttamente le distanze</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+e+Google+Maps%3A+come+misurare+correttamente+le+distanze&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2010-04-25&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2010/04/25/arcgis-server-e-google-maps-come-misurare-correttamente-le-distanze/&amp;rft.language=English"></span>

		<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2010/04/mercator1-150x150.png" />
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2010/04/mercator1.png" medium="image">
			<media:title type="html">mercator</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2010/04/mercator1-150x150.png" />
		</media:content>
	</item>
		<item>
		<title>ArcGIS Server 9.3: impressioni di utilizzo</title>
		<link>http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/</link>
		<comments>http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/#comments</comments>
		<pubDate>Sun, 02 Aug 2009 20:22:28 +0000</pubDate>
		<dc:creator>Alessio Di Lorenzo</dc:creator>
				<category><![CDATA[Strumenti]]></category>
		<category><![CDATA[Dojo]]></category>
		<category><![CDATA[ESRI]]></category>
		<category><![CDATA[Javascript]]></category>
		<category><![CDATA[Web 2.0]]></category>
		<category><![CDATA[webmapping]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/?p=1028</guid>
		<description><![CDATA[	
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+9.3%3A+impressioni+di+utilizzo&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Strumenti&amp;rft.source=TANTO&amp;rft.date=2009-08-02&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/&amp;rft.language=English"></span>
Posso dire di essere un sostenitore dell&#8217;open source e senza dubbio preferisco avere a che fare con software, tecnologie e formati aperti. Al movimento del software libero sono molto legato, per alcuni versi ne faccio parte e, quando posso, cerco di dare i miei microscopici contributi qui e la. Il mio mondo (digitale) ideale è [...]]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+9.3%3A+impressioni+di+utilizzo&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Strumenti&amp;rft.source=TANTO&amp;rft.date=2009-08-02&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p><img src="http://blog.spaziogis.it/wp-content/uploads//2009/07/esri.jpg" alt="esri" width="171" height="208" class="alignright size-full wp-image-1049" />Posso dire di essere un sostenitore dell&#8217;open source e senza dubbio preferisco avere a che fare con software, tecnologie e formati aperti. Al movimento del software libero sono molto legato, per alcuni versi ne faccio parte e, quando posso, cerco di dare i miei microscopici contributi <a href="http://ka-map.ominiverdi.org/wiki/index.php/Search_By_Filter_Implementation" target="_blank">qui</a> e <a href="http://wiki.ubuntu-it.org/GruppoForum" target="_blank">la</a>.<br />
Il mio mondo (digitale) ideale è un mondo in cui tutto il software è libero e, soprattutto, in cui le persone si scambiano dati e servizi in formati standard e liberi.<br />
Il mondo reale, però, è fatto anche di altro e quando c&#8217;è da portare a casa la proverbiale pagnotta è bene tenerlo a mente. Inoltre penso che sia un preciso dovere, per un buon analista, essere sempre aggiornato sulle soluzioni esistenti indipendentemente dalla licenza che le accompagna.<br />
In questo articolo racconterò quindi le impressioni che ho avuto durante le mie prime due settimane di lavoro con ArcGIS Server 9.3. Inizio subito col dire che partivo prevenuto nei confronti di questa piattaforma, date le allucinanti esperienze con ArcIMS, ma devo ammettere di essere rimasto piacevolmente sorpreso!</p>
	<h3>Che cos&#8217;è?</h3>
	<p>Bene, mi tocca entrare nel vivo e dare una definzione di massima che aiuti a capire meglio di cosa stiamo parlando.<br />
Senza scendere troppo nel dettaglio tecnico, possiamo dire che ArcGIS Server è un ambiente che permette di pubblicare <i>geowebservices</i> sulla base dei quali si potranno poi sviluppare applicazioni di web-mapping.<br />
Su questo fronte lo spettro di possibilità offerte da ArcGIS Server 9.3 agli sviluppatori GIS è davvero ampio. Si va dagli ADF (Advanced Development Framework) per gli ambienti .NET e Java, alle API Javascript, Flex e &#8211; di recente &#8211; Silverlight.<br />
C&#8217;è anche un wizard che permette di pubblicare un&#8217;applicazione web senza grosse pretese di originalità e nel giro di qualche click, pur non avendo alcuna conoscenza di programmazione.</p>
	<h3>Come funziona?</h3>
	<p>Innanzitutto si deve installare! <img src='http://blog.spaziogis.it/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /><br />
Non ho avuto modo di provare l&#8217;installazione in ambiente GNU/Linux, ma in ambiente Windows la procedura non si discosta da quella classica che caratterizza la maggior parte dei programmi. Di certo avete presente il tipico: “Avanti → Avanti → Ok”&#8230;<br />
Ultimata l&#8217;installazione vera e propria, vengono richieste delle informazioni utili alla configurazione dell&#8217;ambiente e, infine, si procede con l&#8217;autenticazione della licenza.<br />
Al riavvio potremo finalmente effettuare il login in ArcGIS Server Manager, un applicativo di amministrazione da browser, oppure, se preferiamo, connetterci all&#8217;istanza di ArcGIS Server usando ArcCatalog.</p>
	<p>A questo punto siamo pronti per tirarci su le maniche e creare <a href="http://resources.esri.com/arcgisserver/index.cfm?fa=services" target="_blank">servizi di vario tipo</a> (mapservice, dataservice, gisservice, geoprocessing e geocoding service).<br />
Consideriamo per esempio il mapservice, un tipo di servizio che serve ad esporre una mappa composta da uno o più layer, sui quali si possono eseguire delle operazioni (<i>task</i>) come find, query e identify.<br />
Pubblicare un mapservice è decisamente semplice. Basta avere un progetto redatto in  ArcMap (un normale file .mxd) ed effettuare delle semplici scelte per la configurazione del servizio.<br />
Oltre al servizio proprietario ESRI, sono a disposizione vari standard: KML, WMS, WFS-T e WCS. </p>
	<h3>Sviluppo client con REST e Javascript</h3>
	<p>ArcGIS Server 9.3 offre, out-of-the box, la possibilità di esporre i servizi secondo il paradigma REST.<br />
Questa, insieme alle <a href="http://resources.esri.com/arcgisserver/index.cfm?fa=JSAPIs" target="_blank">API Javascript</a> basate sull&#8217;ottimo toolkit open source <a href="http://www.dojotoolkit.org/" target="_blank">Dojo</a>, è probabilmente la novità di maggior rilievo di ArcGIS Server 9.3.<br />
Imparare a sfruttare questi mezzi equivale ad aprirsi la possibilità di sviluppare delle applicazioni web 2.0 che, col solo codice lato-client, offrono la maggior parte delle caratteristiche che normalmente ci si aspetta di trovare in una applicazione di web-mapping.<br />
<a href="http://resources.esri.com/help/9.3/arcgisserver/apis/javascript/arcgis/help/jssamples_start.htm" target="_blank">Qui</a> ci sono alcuni esempi che sicuramente vale la pena di esplorare per rendersi conto delle potenzialità delle API.</p>
	<p>E&#8217; interessante, inoltre, che l&#8217;ultima versione di OpenLayers, la 2.8, permetta di utilizzare anche i <a href="http://openlayers.org/dev/examples/arcgis93rest.html" target="_blank">layer REST</a> di ArcGIS Server 9.3.<br />
Se volete saperne di più sull&#8217;argomento vi consiglio caldamente <a href="http://resources.esri.com/arcgisserver/apis/javascript/arcgis/index.cfm?fa=mediaGalleryDetails&amp;mediaID=8BE10472-1422-2418-A06335EA0FA3EE57" target="_blank">questo</a> video!</p>
	<h3>Pro e contro</h3>
	<p>Siamo alla fine del post ed è ora di fare un bilancio.<br />
Prima le cattive notizie: il supporto, non me ne vogliano in ESRI Italia, è assolutamente inadeguato!<br />
Se si naviga tra <a href="http://edn.esri.com/" target="_blank">EDN</a> e <a href="http://resources.esri.com/arcgisserver/" target="_blank">Resource Gateway</a> o si bazzica la comunità internazionale sul <a href="http://forums.esri.com" target="_blank">forum</a>, in fin dei conti non è proprio malaccio (anzi, sul forum ci sono utenti molto preparati e dispobili grazie ai quali ho risolto alcuni piccoli intoppi).<br />
Però chi ha acquistato un prodotto <b>in Italia</b>, pagandolo profumatamente, tollera con un po&#8217; di mal di pancia che il supporto locale non sappia nemmeno dare un aiuto di tipo “getting started” se ci si vuole discostare dall&#8217;uso del wizard o dello sviluppo con l&#8217;ADF Java o .NET.<br />
Personalmente, ho telefonato 3 volte al supporto ponendo delle domande tecniche precise e non ho mai ricevuto una risposta utile dall&#8217;interlocutore (quasi sempre: &#8220;apra un ticket&#8221;). Oggi, con poche settimane di esperienza di sviluppo con queste API alle spalle, mi rendo conto che le mie domande erano davvero molto semplici, il che mi porta a pensare che quello dello sviluppo con le API Javascript, in ESRI Italia, sia un tema molto trascurato.<br />
Comunque devo essere onesto e dire che in altre occasioni ho trovato utilissimo (spesso risolutivo) il supporto di ESRI Italia. Questo mi fa ben sperare per il futuro nel caso in cui a Roma decidano di dedicare un po&#8217; di attenzione anche quei balordi (come il sottoscritto) che si sono fissati col Javascript!              </p>
	<p>Passiamo ai pro che, invece, sono tanti:</p>
	<ul>
	<li>scalabilità dell&#8217;architettura</li>
	<li>semplicità nella configurazione e nello sviluppo degli applicativi</li>
	<li>versatilità delle API e possibilità di creare Mash-Up praticamente con tutto</li>
	<li>buon supporto agli standard del settore</li>
	</ul>
	<h3>Basta con le chiacchiere!</h3>
	<p>Cliccando <a href="http://blog.spaziogis.it/static/agsdemo/" target="_blank">qui</a>, potete vedere un piccolo esempio live da me realizzato.<br />
Divertitevi (si fa per dire&#8230;) a fare lo stesso&#8230; e <a href="http://resources.esri.com/arcgisserver/apis/javascript/arcgis/index.cfm?fa=codeGallery" target="_blank">condividete</a> il risultato! <img src='http://blog.spaziogis.it/wp-includes/images/smilies/icon_biggrin.gif' alt=':D' class='wp-smiley' />
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/">ArcGIS Server 9.3: impressioni di utilizzo</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/feed/</wfw:commentRss>
		<slash:comments>27</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=ArcGIS+Server+9.3%3A+impressioni+di+utilizzo&amp;rft.aulast=Di+Lorenzo&amp;rft.aufirst=Alessio&amp;rft.subject=Strumenti&amp;rft.source=TANTO&amp;rft.date=2009-08-02&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2009/08/02/arcgis-server-93-impressioni-di-utilizzo/&amp;rft.language=English"></span>

		<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2009/07/esri-150x150.jpg" />
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2009/07/esri.jpg" medium="image">
			<media:title type="html">esri</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2009/07/esri-150x150.jpg" />
		</media:content>
	</item>
	</channel>
</rss>
