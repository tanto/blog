<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:gml="http://www.opengis.net/gml"

	xmlns:media="http://search.yahoo.com/mrss/"
	>

<channel>
	<title>TANTO &#187; standard</title>
	<atom:link href="http://blog.spaziogis.it/tag/standard/feed/" rel="self" type="application/rss+xml" />
	<link>http://blog.spaziogis.it</link>
	<description>le cose che ci piacciono ...</description>
	<lastBuildDate>Mon, 07 Nov 2016 09:59:24 +0000</lastBuildDate>
	<language>it-IT</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<xhtml:meta xmlns:xhtml="http://www.w3.org/1999/xhtml" name="robots" content="noindex" />
		<item>
		<title>O che bel tassello marcondirondirondello &#8230;</title>
		<link>http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/</link>
		<comments>http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/#comments</comments>
		<pubDate>Mon, 28 Jan 2013 07:00:00 +0000</pubDate>
		<dc:creator>Andrea Borruso</dc:creator>
				<category><![CDATA[Didattica]]></category>
		<category><![CDATA[osgeo]]></category>
		<category><![CDATA[gdal]]></category>
		<category><![CDATA[opensource]]></category>
		<category><![CDATA[standard]]></category>
		<category><![CDATA[tiling]]></category>
		<category><![CDATA[tms]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/?p=5392</guid>
		<description><![CDATA[In questo articolo viene mostrato come leggere una sorgente di dati a tasselli, generata secondo standard TMS, e convertirla in un'unica immagine georeferenziata.]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=O+che+bel+tassello+marcondirondirondello+%26%238230%3B&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.subject=osgeo&amp;rft.source=TANTO&amp;rft.date=2013-01-28&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p><img class="alignright size-full wp-image-5398" src="http://blog.spaziogis.it/wp-content/uploads//2013/01/indici_tassello.png" alt="indici_tassello" width="200" height="200" />La cartografia digitale è ormai da tempo invasa da milioni di <strong>tasselli</strong>. I <em>layer</em> di Virtual Earth (che sono vecchio!), OpenStreetMap, Yahoo! Maps, Google Maps, ecc. sono da tempo distribuiti a pezzetti da 256&#215;256 pixel e poi ricomposti nei nostri browser. Le modalità con cui la cosa viene realizzata sono &#8220;abbastanza&#8221; standard; se si prova però ad approfondire un po&#8217;, si scopre ad esempio una grande varietà nel definire l&#8217;indice numerico associato ad un dato tassello, di una certa zona del mondo, ad uno specifico livello di zoom. La mia amata/odiata Sicilia ad esempio, a livello di ingrandimento &#8220;6&#8243;, la posso richiamare nei modi diversi che vedete qui accanto, per tre dei più diffusi indici di tassellamento. Per approfondire il tema vi consiglio di partire da <a href="http://www.maptiler.org/google-maps-coordinates-tile-bounds-projection/" target="_blank">qui</a>.</p>
	<p>Nel tempo queste mattonelle cartografiche sono aumentate a dismisura e ce le troviamo anche in tasca. Penso ai nostri <em><strong>smartphone</strong></em> e al fatto che la quasi totalità delle basi cartografiche delle applicazioni che installiamo in questi sono distribuite a tasselli.</p>
	<p>E nel prossimo futuro la diffusione sarà ancora più pervasiva, in quanto passeranno dall&#8217;essere consultati quasi esclusivamente tramite servizi/server web, all&#8217;essere letti direttamente da un file residente sul nostro terminale. Un esempio per tutti è quello del <a href="http://www.opengeospatial.org/projects/groups/geopackageswg" target="_blank"><strong>GeoPackage</strong></a>, un formato standard che l&#8217;<strong>OGC</strong> sta definendo, in cui le basi <em>raster</em> potranno essere archiviate proprio a tasselli. Un po&#8217; come <a href="http://www.gaia-gis.it/gaia-sins/" target="_blank"><em>rasterlite</em></a> di Sandro Furieri, che credo sia in qualche modo lo scheletro portante di questo <strong>nuovo formato</strong> OGC.</p>
	<p>I tasselli sono talmente tanti che ormai spesso trovo negli <em>hard-disk</em>, <em>pen-drive</em> USB, DVD (come sono vecchio!), schede SD, ecc. quelle strane cartelle a loro volta suddivise in decine e decine (nel caso migliore) di sottocartelle, tipiche della struttura di archiviazione su <em>file system</em> di basi dati tassellate e piramidate.</p>
	<p>Proprio per questo ho pensato di scrivere un articolo su come accedere ad un archivio cartografico di questo tipo, che in qualche modo è il complementare ad un <a href="http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/" target="_blank"> altro</a> scritto nel lontanissimo 2008 e in cui viene illustrato come tassellare un&#8217;immagine.</p>
	<h2>Come accedere ad un archivio cartografico a tasselli e ricomporlo in un unica immagine georeferenziata?</h2>
	<p>In sé la cosa sembra ovvia, in quanto si tratta di formati file leggibili da qualsiasi terminale con qualsiasi sistema operativo: parliamo infatti nella stragrande maggioranza dei casi di .jpg e .png. Sfoglio le cartelle, faccio doppio click su una delle immagini e le visualizzo in un attimo. E dove è finita l&#8217;<strong>informazione geografica</strong>?</p>
	<p>Se le apro infatti con un visualizzatore di immagini è normale che le uniche coordinate riconosciute siano i pixel, ma se provate ad aprire lo stesso tassello con una applicazione GIS, il risultato non cambia. L&#8217;informazione geografica infatti non è presente nemmeno in qualche <em>tag</em> nascosto internamente ai file e quindi non può essere letta. Per assurdo tutti i tasselli sembrano sovrapposti nello stesso punto della terra, ad una sola risoluzione.</p>
	<p>L&#8217;arcano si risolve proprio nella lettura della struttura della cartella in cui sono archiviati e quindi nella conoscenza dell&#8217;indice utilizzato per generare tutti i pezzetti di mondo alle varie scale di ingrandimento. Data infatti una certa modalità di tassellamento, ogni punto della terra è associato ad una certa tessera di questo enorme mosaico, per un certo livello di zoom.</p>
	<p><img class="alignright size-full wp-image-5399" style="margin: 2px;" src="http://blog.spaziogis.it/wp-content/uploads//2013/01/struttura.png" alt="struttura" width="259" height="148" />Ma sporchiamoci un po&#8217; le mani. Nell&#8217;immagine accanto una cartella di <em>output</em> di un tassellamento, con le sue sottocartelle, che potete scaricare da <a href="http://blog.spaziogis.it/static/tassello/NE2_50M_SR_W.zip" target="_blank">qui</a>. Se la si sfoglia un po&#8217; e si provano ad aprire i singoli file che troviamo all&#8217;interno delle varie cartelle, è evidente che quello che varia per ogni tassello è l&#8217;ingrandimento e/o l&#8217;area della Terra rappresentata. Posizione e zoom, ovvero x, y e z.</p>
	<p>In questo esempio, ed è facile verificarlo in modo empirico, il primo livello di sottocartelle è legato all&#8217;ingrandimento: dalla cartella &#8220;0&#8243; con la risoluzione più bassa a quella &#8220;4&#8243; con quella più alta. All&#8217;interno di queste invece le eventuali sottocartelle rappresentano spostamenti lungo l&#8217;asse x. Nella figura di sopra quindi le cartelle &#8220;NE2_50M_SR_W\1&#8243; e &#8220;NE2_50M_SR_W\1\1&#8243; contengono, per il livello di zoom &#8220;1&#8243;, porzioni di Terra affiancate. La variazione lungo l&#8217;asse y è invece resa, per ogni cartella, dal nome del file: il tassello &#8220;1.png&#8221; sta a Nord di quello &#8220;0.png&#8221;.</p>
	<p>Nella figura sottostante ho schematizzato la cosa, per rendere ancora più leggibile e chiara questa struttura.</p>
	<p><img class="alignnone size-full wp-image-5400 aligncenter" src="http://blog.spaziogis.it/wp-content/uploads//2013/01/dettaglio_web.png" alt="dettaglio_web" width="498" height="533" /></p>
	<p>Conoscere tutto questo ovviamente non basta a posizionare queste immagini nello spazio, ma soltanto in modo relativo. Per fortuna però il tassellamento viene fatto secondo <strong>standard</strong>, magari diversi, ma definiti. Quindi se conosciamo (o riconosciamo) lo standard con cui sono state generate le nostre tessere, basterà essere in possesso di un <em>client</em> che sappia leggere questo standard e queste verranno posizionate correttamente nello spazio cartografico. Un po&#8217; come quando accediamo ad un servizio WMS.</p>
	<p>La cartella di esempio che sto usando per questo esercizio contiene al suo interno (per fortuna c&#8217;è quasi sempre qualcosa di simile) il seguente file .xml.</p>
	<pre class="brush: xml; ">
&lt; ?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;tilemap version=&quot;1.0.0&quot; tilemapservice=&quot;http://tms.osgeo.org/1.0.0&quot;&gt;
&lt;title&gt;NE2_50M_SR_W&lt;/title&gt;
&lt;abstract&gt;&lt;/abstract&gt;
&lt;srs&gt;EPSG:900913&lt;/srs&gt;
&lt;boundingbox minx=&quot;-85.05112878000000&quot; miny=&quot;-180.00000000000000&quot; maxx=&quot;85.05112878000000&quot; maxy=&quot;179.99871994141003&quot;&gt;&lt;/boundingbox&gt;
&lt;origin x=&quot;-85.05112878000000&quot; y=&quot;-180.00000000000000&quot;&gt;&lt;/origin&gt;
&lt;tileformat width=&quot;256&quot; height=&quot;256&quot; mime-type=&quot;image/png&quot; extension=&quot;png&quot;&gt;&lt;/tileformat&gt;
&lt;tilesets profile=&quot;mercator&quot;&gt;
&lt;tileset href=&quot;0&quot; units-per-pixel=&quot;156543.03390000000945&quot; order=&quot;0&quot;&gt;&lt;/tileset&gt;
&lt;tileset href=&quot;1&quot; units-per-pixel=&quot;78271.51695000000473&quot; order=&quot;1&quot;&gt;&lt;/tileset&gt;
&lt;tileset href=&quot;2&quot; units-per-pixel=&quot;39135.75847500000236&quot; order=&quot;2&quot;&gt;&lt;/tileset&gt;
&lt;tileset href=&quot;3&quot; units-per-pixel=&quot;19567.87923750000118&quot; order=&quot;3&quot;&gt;&lt;/tileset&gt;
&lt;tileset href=&quot;4&quot; units-per-pixel=&quot;9783.93961875000059&quot; order=&quot;4&quot;&gt;&lt;/tileset&gt;
&lt;/tilesets&gt;
&lt;/tilemap&gt;
</pre>
	<p>E&#8217; un piccolo tesoro che ci dice quasi tutto della struttura a tasselli che stiamo analizzando:</p>
	<ul>
	<li>la specifica sul formato di tassellamento, ovvero il <a href="Tile%20Map%20Service%20Specification">TMS 1.0</a> (<strong>Tile Map Service</strong>) di OSGeo;</li>
	<li>lo <em>Spatial Reference System</em> usato;</li>
	<li>il <em>Bounding Box</em>;</li>
	<li>l&#8217;origine del mosaico dei tasselli;</li>
	<li>formato e dimensioni dei tasselli;</li>
	<li>e la risoluzione per ogni livello di zoom.</li>
	</ul>
	<p>Non ci resta che trovare un <em>client</em> compatibile con lo standard TMS e provare a leggere questa struttura dati. La scelta va ancora una volta verso il Victorinox delle librerie spaziali, ovvero <strong>GDAL/OGR</strong>. Sfruttando infatti i <em><strong>minidriver</strong></em> di GDAL, descritti in fondo nella <a href="http://www.gdal.org/frmt_wms.html" target="_blank">pagina</a> di accesso ai servizi WMS, è possibile accedere direttamente a dati esposti in TMS; sia come <em>che su</em> file system. Prima è però necessario definire un file di configurazione, come descritto nella documentazione di cui sopra e di cui si riporta a seguire un esempio, basato sui dati che sto usando per questo post.</p>
	<pre class="brush: xml; ">
&lt;gdal_wms&gt;
&lt;service name=&quot;TMS&quot;&gt;
&lt;serverurl&gt;
file://C:/tmp/NE2_50M_SR_W/${z}/${x}/${y}.png
&lt;/serverurl&gt;
&lt;/service&gt;
&lt;imageformat&gt;image/png&lt;/imageformat&gt;
&lt;datawindow&gt;
&lt;upperleftx&gt;-20037508.34&lt;/upperleftx&gt;
&lt;upperlefty&gt;20037508.34&lt;/upperlefty&gt;
&lt;lowerrightx&gt;20037508.34&lt;/lowerrightx&gt;
&lt;lowerrighty&gt;-20037508.34&lt;/lowerrighty&gt;
&lt;tilelevel&gt;4&lt;/tilelevel&gt;
&lt;tilecountx&gt;1&lt;/tilecountx&gt;
&lt;tilecounty&gt;1&lt;/tilecounty&gt;
&lt;/datawindow&gt;
&lt;projection&gt;EPSG:900913&lt;/projection&gt;
&lt;blocksizex&gt;256&lt;/blocksizex&gt;
&lt;blocksizey&gt;256&lt;/blocksizey&gt;
&lt;bandscount&gt;3&lt;/bandscount&gt;
&lt;maxconnections&gt;10&lt;/maxconnections&gt;
&lt;cache&gt;&lt;/cache&gt;
&lt;/gdal_wms&gt;
</pre>
	<p>Il file contiene, in modo differente, quasi le stesse informazioni descritte prime per il file .xml. Tra queste:</p>
	<ul>
	<li>il tipo di servizio - &lt;service name&gt;</li>
	<li>l&#8217;indirizzo per accedere ai dati - &lt;serverurl&gt;</li>
	<li>il formato immagine della sorgente dati - &lt;imageformat&gt;</li>
	<li>il <em>Bounding Box </em>- &lt;upperleftx&gt;, &lt;upperlefty&gt;, &#8230;</li>
	<li>il livello di Zoom con la risoluzione più alta, che ricavo proprio dal file.xml di sopra - &lt;tilelevel&gt;</li>
	<li>lo <em>Spatial Reference System -</em> &lt;projection&gt;</li>
	<li>la dimensione in pixel dei tasselli - &lt;blocksizex&gt;, &lt;blocksizey&gt;</li>
	</ul>
	<p>Il valore del parametro ServerUrl &#8211; ovvero l&#8217;indirizzo della sorgente dati &#8211; è di solito quello di un servizio web con una forma di questo tipo: http://myserver.it/NE2_50M_SR_W/${z}/${x}/${y}.png.</p>
	<p>Nel caso descritto i dati sono su un <em>hard-disk</em> di un PC e quindi, l&#8217;accesso non è in HTTP ma secondo lo schema URI di accesso a file: file://C:/tmp/NE2_50M_SR_W/${z}/${x}/${y}.png (in questo esempio la cartella dei dati è all&#8217;interno di &#8220;C:\tmp&#8221;).<br />
Nell&#8217;URI è necessario indicare come è realizzata, in termini di struttura e nomi dei file, la mappatura di x, y e z. Nel caso in esame abbiamo visto che è resa come z/x/y.png, e cosi è stata riportata nel file di configurazione. Bisogna soltanto fare attenzione alla sintassi che prevede l&#8217;utilizzo di alcuni caratteri speciali.</p>
	<p>Creato il file di configurazione e salvato con nome (ad esempio &#8220;input.txt&#8221;), non resta che provare a leggere i dati. Il primo passo, un po&#8217; per fare <em>debug</em> è aprire la shell e digitare:</p>
	<pre>gdalinfo input.txt</pre>
	<p>Come risultato, se tutto è correttamente configurato, si otterrà:</p>
	<pre>Driver: WMS/OGC Web Map Service
Files: input.txt
Size is 4096, 4096
Coordinate System is:
PROJCS[\"Google Maps Global Mercator\",
    GEOGCS[\"WGS 84\",
        DATUM[\"WGS_1984\",
            SPHEROID[\"WGS 84\",6378137,298.257223563,
                AUTHORITY[\"EPSG\",\"7030\"]],
            AUTHORITY[\"EPSG\",\"6326\"]],
        PRIMEM[\"Greenwich\",0,
            AUTHORITY[\"EPSG\",\"8901\"]],
        UNIT[\"degree\",0.01745329251994328,
            AUTHORITY[\"EPSG\",\"9122\"]],
        AUTHORITY[\"EPSG\",\"4326\"]],
    PROJECTION[\"Mercator_2SP\"],
    PARAMETER[\"standard_parallel_1\",0],
    PARAMETER[\"latitude_of_origin\",0],
    PARAMETER[\"central_meridian\",0],
    PARAMETER[\"false_easting\",0],
    PARAMETER[\"false_northing\",0],
    UNIT[\"Meter\",1],
    EXTENSION[\"PROJ4\",\"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs\"],
    AUTHORITY[\"EPSG\",\"900913\"]]
Origin = (-20037508.340000000000000,20037508.340000000000000)
Pixel Size = (9783.939619140624900,-9783.939619140624900)
Image Structure Metadata:
  INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left  (-20037508.340,20037508.340) (180d 0' 0.00\"W, 85d 3' 4.06\"N)
Lower Left  (-20037508.340,-20037508.340) (180d 0' 0.00\"W, 85d 3' 4.06\"S)
Upper Right (20037508.340,20037508.340) (180d 0' 0.00\"E, 85d 3' 4.06\"N)
Lower Right (20037508.340,-20037508.340) (180d 0' 0.00\"E, 85d 3' 4.06\"S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01\"E,  0d 0' 0.01\"N)
Band 1 Block=256x256 Type=Byte, ColorInterp=Red
  Overviews: 2048x2048, 1024x1024, 512x512, 256x256
Band 2 Block=256x256 Type=Byte, ColorInterp=Green
  Overviews: 2048x2048, 1024x1024, 512x512, 256x256
Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
  Overviews: 2048x2048, 1024x1024, 512x512, 256x256</pre>
	<p>Siamo riusciti a leggere correttamente le informazioni sui nostri dati e non abbiamo avuto nessun errore. A questo punto il comando per la ricomposizione in un&#8217;unica immagine georeferenziata è la cosa più ovvia, è gdal_translate:</p>
	<pre>gdal_translate input.txt output.tif</pre>
	<p>L&#8217;output sarà un unico file geotiff, <em>Mission Accomplished!</em></p>
	<p>Questo ovviamente è un caso semplice, costruito in modo che sia replicabile e didatticamente valido. Nella pratica quotidiana è tutto un po&#8217; più complicato, ma leggendo i riferimenti indicati nell&#8217;articolo, documentandosi un po&#8217;, sarà possibile replicare la cosa con i propri dati.<br />
La carta di base da cui ho generato i tasselli (che poi ho ricomposto) è la bella &#8220;<em>Natural Earth II with Shaded Relief and Water</em>&#8220;. E&#8217; rilasciata sotto <strong>pubblico dominio</strong> e scaricabile da <a href="http://www.naturalearthdata.com/downloads/50m-natural-earth-2/50m-natural-earth-ii-with-shaded-relief-and-water/" target="_blank">qui</a>.</p>
	<p>Con i <em>minidriver</em> di GDAL/OGR si possono fare tante altre cose, come accedere e quindi (volendo) scaricare, i tasselli di Bing Maps e Google Maps, facendo però la giusta attenzione ai termini legali imposti. Inoltre il file di testo di input creato sopra, può essere trascinato in <em>drag &amp; drop</em> su <strong>Quantum GIS</strong> e visualizzato pochi secondi dopo. Questo sempre grazie all&#8217;esistenza degli standard e di GDAL/OGR.</p>
	<p>Questo articolo diverrà magari presto &#8220;superato&#8221; proprio perché l&#8217;invasione dei tasselli sarà probabilmente peggiore di un <strong>attacco <em>zombie</em></strong>, e saranno pertanto sviluppate modalità di accesso, procedure e interfacce ancora più semplici e trasparenti. Il fatto di poter accedere al basso livello descritto in questo articolo, offre comunque una potenza e una libertà di impieghi che difficilmente si potrà ottenere tramite strumenti di livello più alto.</p>
	<p>In ultimo ringrazio <a href="http://blog.spaziogis.it/author/lorenzop/" target="_blank"><strong>Lorenzo Perone</strong></a> che mi ha dato gli stimoli per mettere in linea questi pensieri e questo processo.
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/">O che bel tassello marcondirondirondello &#8230;</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=O+che+bel+tassello+marcondirondirondello+%26%238230%3B&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.subject=osgeo&amp;rft.source=TANTO&amp;rft.date=2013-01-28&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2013/01/28/o-che-bel-tassello-marcondirondirondello/&amp;rft.language=English"></span>

		<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2013/01/indici_tassello-150x150.png" />
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2013/01/indici_tassello.png" medium="image">
			<media:title type="html">indici_tassello</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2013/01/indici_tassello-150x150.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2013/01/struttura.png" medium="image">
			<media:title type="html">struttura</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2013/01/struttura-150x148.png" />
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads//2013/01/dettaglio_web.png" medium="image">
			<media:title type="html">dettaglio_web</media:title>
			<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads//2013/01/dettaglio_web-150x150.png" />
		</media:content>
	</item>
		<item>
		<title>Pubblicare facilmente una carta raster sul web</title>
		<link>http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/</link>
		<comments>http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/#comments</comments>
		<pubDate>Tue, 22 Apr 2008 08:00:58 +0000</pubDate>
		<dc:creator>Andrea Borruso</dc:creator>
				<category><![CDATA[Didattica]]></category>
		<category><![CDATA[fwtools]]></category>
		<category><![CDATA[gdal]]></category>
		<category><![CDATA[google-maps]]></category>
		<category><![CDATA[googleearth]]></category>
		<category><![CDATA[piramidazione]]></category>
		<category><![CDATA[standard]]></category>
		<category><![CDATA[tiling]]></category>
		<category><![CDATA[tms]]></category>
		<category><![CDATA[webmapping]]></category>

		<guid isPermaLink="false">http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/</guid>
		<description><![CDATA[	
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Pubblicare+facilmente+una+carta+raster+sul+web&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2008-04-22&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/&amp;rft.language=English"></span>
In un post recente, ho scritto di alcune delle modalità di pubblicazione online di cartografia digitale. Ne sono seguiti dei commenti interessanti, ed alcune email con richieste di consigli e di approfondimento. L&#8217;argomento  mi è sembrato &#8220;caldo&#8221;, e credo valga la pena alimentarlo ulteriormente. Su un blog che vi consiglio di leggere &#8211; thematicmapping blog [...]]]></description>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Pubblicare+facilmente+una+carta+raster+sul+web&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2008-04-22&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/&amp;rft.language=English"></span>
			<content:encoded><![CDATA[	<p>In un <a title="Un’eccellente articolo sulla cartografia online e sulle soluzioni disponibili per produrla (oltre Google Maps)" href="http://blog.spaziogis.it/2008/04/08/uneccellente-articolo-sulla-cartografia-online-e-sulle-soluzioni-disponibili-per-produrla-oltre-google-maps/">post</a> recente, ho scritto di alcune delle modalità di pubblicazione online di cartografia digitale. Ne sono seguiti dei commenti interessanti, ed alcune email con richieste di consigli e di approfondimento. L&#8217;argomento  mi è sembrato &#8220;caldo&#8221;, e credo valga la pena alimentarlo ulteriormente.</p>
	<p>Su un blog che vi consiglio di leggere &#8211; <a title="generating map tiles with gdal2tiles" href="http://blog.thematicmapping.org/2008/03/generating-map-tiles-with-gdal2tiles.html" target="_blank">thematicmapping blog</a> &#8211; ho scoperto dell&#8217;esistenza di <a title="GDAL2Tiles, easy publishing of raster maps on the Internet" href="http://www.klokan.cz/projects/gdal2tiles/" target="_blank">GDAL2Tiles</a>, un software a riga di comando che consente di pubblicare -rapidamente e con efficacia &#8211; una carta raster nelle seguenti modalità: Google Maps, OpenLayers and Google Earth. E&#8217; uno strumento incluso in GDAL/OGR 1.5.0, e quindi anche nell&#8217;ultimo <a title="FWTools homepage" href="http://fwtools.maptools.org/" target="_blank">FWTools</a>.</p>
	<p><img style="border-width: 0px;" src="http://blog.spaziogis.it/wp-content/uploads/2008/04/image-pyramid.jpg" alt="image_pyramid" width="260" height="148" align="left" border="0" /> Il lavoro che fa GDAL2Tiles è quello di leggere un&#8217;immagine georeferenziata, e suddividerla in tasselli da 256 x 256 <em>pixel</em>, con una struttura a piramide (il nome del pacchetto è in qualche modo descrittivo della funzione che svolge). In altre parole a partire da una <em>raster</em>, ne vengono generate diverse a risoluzioni decrescenti, che vengono suddivise in sezioni da 256 <em>pixel</em> (vedi figura).</p>
	<p>Il tassellamento e la piramidazione sono molto efficienti per distribuire <em>raster</em> sul web, in quanto l&#8217;immagine potrà essere visualizzata direttamente alla risoluzione adatta al livello di zoom attivo, e verranno scaricati soltanto i tasselli dell&#8217;area che stiamo osservando a video. E&#8217; il meccanismo che sta dietro al motore di Google Maps e a quello dei maggiori <em>provider</em> di cartografia <em>online</em>.</p>
	<p>Andiamo alla parte pratica e proviamo a mettere online una delle fantastiche immagini presenti su <a title="Natural Earth II - World environment map in natural color" href="http://www.shadedrelief.com/natural2/" target="_blank">Natural Earth II</a>. Si tratta di file (qui sotto un esempio) che rappresentano la terra, così come sarebbe senza l&#8217;influenza dell&#8217;uomo (immaginate Parigi coperta da una foresta temperata &#8230;); una rappresentazione del pianeta, precedente all&#8217;era moderna.</p>
	<p><img style="border: 0px none;" src="http://blog.spaziogis.it/wp-content/uploads/2008/04/natural-earth.jpg" alt="natural_earth" width="500" height="260" border="0" /></p>
	<p>Per il mio esempio ho scaricato la tavola denominata &#8220;<em><a title="Ocean with layered depth tints" href="http://www.nacis.org/data/NE2/NE2_WDB2.jpg" target="_blank">Ocean with layered depth tints</a></em>&#8220;.</p>
	<p>La prima cosa che ho fatto è stata georeferenziarla. Conosco le coordinate dei 4 vertici della tavola, ho FWTools installato, e dalla shell FWTools lancio il seguente comando:</p>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">&gt; gdal_translate -a_srs EPSG:4326 -gcp 0 0 -180 90 -gcp 16200 0 180 90</pre>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">-gcp 16200 8100 180 -90 NE2_modis3.jpg NE2_modis3.tif</pre>
	<p><a title="gdal_translate" href="http://www.gdal.org/gdal_translate.html" target="_blank">gdal_translate</a> è una delle utility presenti in FWTools; questo il significato dei parametri usati:</p>
	<p><strong>-a_srs</strong> per assegnare il corretto sistema di coordinate (<a title="EPSG:4326" href="http://spatialreference.org/ref/epsg/4326/" target="_blank">EPSG:4326</a>)<br />
<strong>-gcp </strong>per assegnare i vari punti di controllo (prima le coordinate in pixel, e poi quelle del sistema di coordinate scelto)</p>
	<p>A partire dalla jpeg scaricata, ho creato un tif georeferenziata, assegnando come punti di controllo i 4 vertici della carta.</p>
	<p>Dovrò adesso processare l&#8217;immagine con <a title="gdalwarp" href="http://www.gdal.org/gdalwarp.html" target="_blank">gdalwarp</a>:</p>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">&gt; gdalwarp -t_srs EPSG:4326 NE2_modis3.tif NE2_modis3_4326.tif</pre>
	<p><strong>-t_srs </strong>è il parametro per assegnare il sistema di coordinate.</p>
	<p>La mia immagine di partenza è di 16200  x 8100 <em>pixel;</em> GDAL2Tiles la tassellerà e la piramiderà. Ogni tassello che andrò a generare sarà di  256 x 256 pixel. I livelli di piramidazione, corrispondenti ai livelli di zoom possibili, rispecchieranno lo schema della tabella sottostante.</p>
	<table width="480" border="1" cellspacing="2" cellpadding="2">
	<tbody>
	<tr>
	<td valign="top" width="120">
	<p align="center"><strong>Livello di Zoom</strong></p>
	</td>
	<td valign="top" width="120">
	<p align="center"><strong>Dimensione immagine</strong></p>
	</td>
	<td valign="top" width="120">
	<p align="center"><strong>Tasselli</strong></p>
	</td>
	<td valign="top" width="120">
	<p align="center"><strong>Numero totale di tasselli</strong></p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">1</p>
	</td>
	<td valign="top" width="120">
	<p align="center">512 x 256</p>
	</td>
	<td valign="top" width="120">
	<p align="center">2 x 1</p>
	</td>
	<td valign="top" width="120">
	<p align="center">2</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">2</p>
	</td>
	<td valign="top" width="120">
	<p align="center">1024 x 512</p>
	</td>
	<td valign="top" width="120">
	<p align="center">4 x 2</p>
	</td>
	<td valign="top" width="120">
	<p align="center">8</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">3</p>
	</td>
	<td valign="top" width="120">
	<p align="center">2048 x 1024</p>
	</td>
	<td valign="top" width="120">
	<p align="center">8 x 4</p>
	</td>
	<td valign="top" width="120">
	<p align="center">32</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">4</p>
	</td>
	<td valign="top" width="120">
	<p align="center">4096 x 2048</p>
	</td>
	<td valign="top" width="120">
	<p align="center">16 x 8</p>
	</td>
	<td valign="top" width="120">
	<p align="center">128</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">5</p>
	</td>
	<td valign="top" width="120">
	<p align="center">8192 x 4096</p>
	</td>
	<td valign="top" width="120">
	<p align="center">32 x 16</p>
	</td>
	<td valign="top" width="120">
	<p align="center">512</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">6</p>
	</td>
	<td valign="top" width="120">
	<p align="center">16384 x 8192</p>
	</td>
	<td valign="top" width="120">
	<p align="center">64 x 32</p>
	</td>
	<td valign="top" width="120">
	<p align="center">2048</p>
	</td>
	</tr>
	<tr>
	<td valign="top" width="120">
	<p align="center">7</p>
	</td>
	<td valign="top" width="120">
	<p align="center">32768 x 16384</p>
	</td>
	<td valign="top" width="120">
	<p align="center">128 x 64</p>
	</td>
	<td valign="top" width="120">
	<p align="center">8192</p>
	</td>
	</tr>
	</tbody>
	</table>
	<p>Per il mio esempio mi &#8220;accontenterò&#8221; di un livello di zoom massimo pari a 5 e, prima di dare in pasto il mio file a GDAL2Tiles, ne ridurrò le dimensioni di conseguenza:</p>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">&gt; gdal_translate -outsize 8192 4096 NE2_modis3_4326.tif</pre>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">NE2_modis3_4326_5.tif</pre>
	<p><strong>-outsize </strong>per specifcare la larghezza e l&#8217;altezza dell&#8217;immagine di output</p>
	<p>Non mi resta che &#8220;passare&#8221; a GDAL2Tiles, l&#8217;ultimo file generato:</p>
	<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; font-size: 8pt; width: 100%; color: black; line-height: 12pt; font-family: consolas,'Courier New',courier,monospace; background-color: #f4f4f4;">&gt; gdal2tiles -title <span style=\"color: #006080;\">\"Pubblicare una Raster\"</span> -publishurl
http:<span style=\"color: #008000;\">//www.nostroserver.org/maptiles/ -v </span>
NE2_modis3_4326_5.tif cartella_di_output</pre>
	<p><strong>-title </strong>per dare un titolo al progetto<br />
<strong>-publishurl</strong> per definire l&#8217;url delle mappe che pubblicheremo<br />
<strong>-v </strong>per avere un output &#8220;verboso&#8221; del comando, e leggere a video il dettaglio di tutte le operazioni eseguite da GDAL2Tiles</p>
	<p>L&#8217;output del processo sarà una cartella con il seguente contenuto:</p>
	<ul>
	<li>una sottocartella per ognuno dei livelli di piramidazione (in ognuna di queste diverse altre sottocartelle con i vari tasselli da 256 x 256 pixel)</li>
	<li>un file denominato &#8220;openlayers.html&#8221;, ovvero un&#8217;interfaccia web basata su <a title="OpenLayers homepage" href="http://openlayers.org/" target="_blank">OpenLayers</a></li>
	<li>un file denominato &#8220;googlemaps.html&#8221;, ovvero un&#8217;interfaccia web basata su Google Maps</li>
	<li>un file denominato &#8220;tilemapresource.xml&#8221;, ovvero lo schema della struttura dei tasselli di mappa</li>
	<li>un file denominato &#8220;cartella_di_output.kml&#8221;, che ci consentirà di visualizzare in Google Earth l&#8217;immagine processata (vedi figura sotto)</li>
	</ul>
	<p>Bisognerà fare l&#8217;upload di tutti i file creati da GDAL2Tiles, all&#8217;interno della cartella specificata sopra con il parametro <strong>-publishurl</strong>, e testarne infine il risultato.</p>
	<p><strong><a title="GDAL2Tiles openlayers" href="http://blog.spaziogis.it/static/map/gdal2tiles/openlayers.html" target="_blank">Qui</a></strong> potete testare la visualizzazione della mappa in <strong>OpenLayers</strong>, <strong><a title="GDAL2Tiles Google Maps" href="http://blog.spaziogis.it/static/map/gdal2tiles/googlemaps.html" target="_blank">qui</a></strong> in <strong>Google Maps</strong> e <strong><a title="GDAL2Tiles Google Earth" href="http://blog.spaziogis.it/static/map/gdal2tiles/gdal2tiles.kml" target="_blank">qui</a></strong> in <strong>Google Earth</strong>.</p>
	<p><img style="border: 0px none;" src="http://blog.spaziogis.it/wp-content/uploads/2008/04/google-earth.jpg" alt="google_earth" width="484" height="388" border="0" /></p>
	<p>Il file con l&#8217;interfaccia basata su OpenLayers ha bisogno di una patch. <a title="GDAL2Tiles patch openlayers" href="http://blog.spaziogis.it/static/map/gdal2tiles/openlayers.zip" target="_blank">Qui</a> il file con la patch applicata.</p>
	<p>Un bravo webmaster è in grado di portare a termine questa procedura, senza sapere nulla di cartografia digitale? Probabilmente si, ma magari soltanto in modo meccanico e pertanto non saprà applicarla ad esempi differenti da quelli descritti (immaginate di partire da un 25000 IGM).</p>
	<p>Non ci si improvvisa cartografi online, e bisogna sempre documentarsi. Strumenti come questo fanno venire la voglia di farlo e consentono una più rapida valorizzazione e diffusione di queste tematiche. E&#8217; per questo che mi piace GDAL2Tiles.
</p>
<p style="border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#ddd;border:1px solid #ccc;padding:5px;">L'articolo <a href="http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/">Pubblicare facilmente una carta raster sul web</a> &egrave; apparso originariamente su <a href="http://blog.spaziogis.it">TANTO</a>. Rispettane le <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">condizioni di licenza</a>.</p>]]></content:encoded>
			<wfw:commentRss>http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
		
	<span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Pubblicare+facilmente+una+carta+raster+sul+web&amp;rft.aulast=Borruso&amp;rft.aufirst=Andrea&amp;rft.subject=Didattica&amp;rft.source=TANTO&amp;rft.date=2008-04-22&amp;rft.type=blogPost&amp;rft.format=text&amp;rft.identifier=http://blog.spaziogis.it/2008/04/22/pubblicare-facilmente-una-carta-raster-sul-web/&amp;rft.language=English"></span>

		<media:thumbnail url="http://blog.spaziogis.it/wp-content/uploads/2008/04/image-pyramid.jpg" />
		<media:content url="http://blog.spaziogis.it/wp-content/uploads/2008/04/image-pyramid.jpg" medium="image">
			<media:title type="html">image_pyramid</media:title>
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads/2008/04/natural-earth.jpg" medium="image">
			<media:title type="html">natural_earth</media:title>
		</media:content>
		<media:content url="http://blog.spaziogis.it/wp-content/uploads/2008/04/google-earth.jpg" medium="image">
			<media:title type="html">google_earth</media:title>
		</media:content>
	</item>
	</channel>
</rss>
